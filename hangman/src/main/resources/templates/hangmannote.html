<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>à¹€à¸à¸¡à¸”à¸™à¸•à¸£à¸µà¸«à¸£à¸£à¸©à¸² By à¸„à¸£à¸¹à¸à¸µà¹ˆà¹„à¸¡à¹‰</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Symbola&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" type="text/css" href="style.css" />
    <style>
      .letter-box {
      width: 50px;
      height: 50px;
      margin: 5px;
      font-size: 20px;
      display: inline-block; /* Display letters in a row */
    }

    /* Style each image button */
    .image-button {
      display: inline-block;
      margin: 5px;
      text-align: center;
      line-height: 40px;
      background-color: #FFFFFF; /* Bootstrap primary color */
      color: #000; /* Text color */
      border-radius: 5px; /* Rounded corners */
      cursor: pointer; /* Cursor on hover */
    }
    </style>
</head>
<header>
  <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
          <a class="navbar-brand" href="/">à¹€à¸à¸¡à¸”à¸™à¸•à¸£à¸µà¸«à¸£à¸£à¸©à¸² By à¸„à¸£à¸¹à¸à¸µà¹ˆà¹„à¸¡à¹‰</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                  <li class="nav-item">
                      <a class="nav-link" href="/hangmannote">à¸£à¸§à¸¡à¸œà¸¥à¸•à¸±à¸§à¹‚à¸™à¹Šà¸•</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/hangmanchord">à¸—à¸°à¸¥à¸¸à¸—à¸°à¸¥à¸§à¸‡à¸•à¸²à¸¡à¸¥à¹ˆà¸²à¸„à¸­à¸£à¹Œà¸”</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/viewscore">à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸¥à¹ˆà¸™</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/signout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                  </li>
              </ul>
          </div>
      </div>
  </nav>
</header>
<body>

  <div class="center container mt-5 rounded" style="max-width: 500px;">
    <br>
    <div id="round" style="color: #FFFFFF;">à¸‚à¹‰à¸­à¸—à¸µà¹ˆ <span id="round-number" style="color: #FFFFFF"></span></div>
    <div id="timer" style="color: #FFFFFF">à¹€à¸«à¸¥à¸·à¸­à¹€à¸§à¸¥à¸² <span id="timer-count" style="color: #FFFFFF"></span> à¸§à¸´à¸™à¸²à¸—à¸µ</div>
    <canvas id="hangmanCanvas" width="200" height="200"></canvas>
    <div id="guess-note" style="color: #FFFFFF">à¸œà¸ªà¸¡à¹‚à¸™à¹‰à¸•à¹ƒà¸«à¹‰à¹„à¸”à¹‰</div>
    <div id="guess-note-symbol" class="center rounded container mt-5" style="background-color: #FFFFFF; max-width: 70px;"></div>
    
    <div class="container mt-5">
      <div class="row">       
          <div id="input-note" class="rounded container" style="background-color: #FFFFFF;"></div>
      </div>
      <br>
      <div class="row">
        <div id="letter-box" style="color: #FFFFFF;"></div>
      </div>
      <br>
      <div class="row">
        <div class="col-5">
          <button id="clear-button" style="font-size: 16px;" type="button" class="btn btn-secondary" onclick="clearButton()">à¸¥à¹‰à¸²à¸‡</button>
        </div>
        <div class="col-1">
        </div>
        <div class="col-5">
          <button id="submit-button" style="font-size: 16px;" type="button" class="btn btn-primary" onclick="submitWord()">à¸ªà¹ˆà¸‡à¸„à¸³à¸•à¸­à¸š</button>
        </div>
      </div>
    </div>
    <div id="message" style="color: #FFFFFF"></div>
    <div id="score-text" style="color: #FFFFFF">à¹„à¸”à¹‰ <span id="earn-score" style="color: #FFFFFF"></span> à¸„à¸°à¹à¸™à¸™</div>
    <br>
    <div>
      <button class="btn btn-primary" id="next-round-btn" onclick="nextRound()">à¸‚à¹‰à¸­à¸•à¹ˆà¸­à¹„à¸›</button>
      <button id="try-again" type="button" class="btn btn-danger" onclick="restartGame()">à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ</button>
    </div>
    <br></br>
  </div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>

  const gameName = "Hangman Note";
  //à¹‚à¸ˆà¸—à¸¢à¹Œ
  const guessList = ['ğ…','ğ…','ğ…','ğ…','ğ…']
  
  // à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¹ƒà¸™à¹‚à¸ˆà¸—à¸¢à¹Œ
  const symbolList = {};
  symbolList[1] = ['ğ…Ÿ','ğ… ','ğ…¡','ğ…¡.'];
  symbolList[2] = ['ğ….','ğ…Ÿ','ğ… .','ğ…¡'];
  symbolList[3] = ['ğ…Ÿ.','ğ… .','ğ…¡','ğ…¡.'];
  symbolList[4] = ['ğ…Ÿ.','ğ… ','ğ…¡','ğ…¡.'];
  symbolList[5] = ['ğ…Ÿ','ğ… .','ğ…¡','ğ…¡.'];

  // à¹‚à¸«à¸¥à¸”à¸ à¸²à¸à¸•à¸±à¸§à¹‚à¸™à¹‡à¸•
  const symbolPath = {};
  symbolPath['ğ…'] = 'wholenote.png';
  symbolPath['ğ….'] = 'wholenotedot.png';
  symbolPath['ğ…'] = 'halfnote.png';
  symbolPath['ğ….'] = 'halfnotedot.png';
  symbolPath['ğ…Ÿ'] = 'quarternote.png';
  symbolPath['ğ…Ÿ.'] = 'quarternotedot.png';
  symbolPath['ğ… '] = 'eightnote.png';
  symbolPath['ğ… .'] = 'eightnotedot.png';
  symbolPath['ğ…¡'] = 'sixteenthnote.png';
  symbolPath['ğ…¡.'] = 'sixteenthnotedot.png';
  
  //à¸­à¸±à¸•à¸£à¸²à¸ªà¹ˆà¸§à¸™à¹‚à¸™à¹Šà¸•
  let symbolDic = {};
  symbolDic['ğ…'] = 4;
  symbolDic['ğ…'] = 2;
  symbolDic['ğ…Ÿ'] = 1;
  symbolDic['ğ… '] = 0.5;
  symbolDic['ğ…¡'] = 0.25;
  let guessedWord = [];
  let incorrectGuessCount = 0; //à¸™à¸±à¸šà¸•à¸­à¸šà¸œà¸´à¸”
  let timer;
  let gamestart = false;
  let guessNote = '';
  let score = 0.0; //à¸„à¸°à¹à¸™à¸™à¸£à¸§à¸¡
  let roundScore = 2.0; //à¸„à¸°à¹à¸™à¸™à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸£à¸­à¸š
  let currentRound = 1; //à¸£à¸­à¸š
  const round = 5; //à¸ˆà¸³à¸™à¸§à¸™à¸£à¸­à¸šà¸ªà¸¹à¸‡à¸ªà¸¸à¸”
  let enteredWord = '';

  const canvas = document.getElementById('hangmanCanvas');
  const ctx = canvas.getContext('2d');

  const letterBox = document.getElementById('letter-box');
  const inputNote = document.getElementById('input-note');
  const timerCount = document.getElementById('timer-count');
  const guessSymbol = document.getElementById('guess-note-symbol');
  const earnScore = document.getElementById('earn-score');
  const scoreText = document.getElementById('score-text');
  const timerText = document.getElementById('timer');
  const roundNumber = document.getElementById('round-number');

  // à¸‚à¸¶à¹‰à¸™à¸£à¸­à¸šà¹ƒà¸«à¸¡à¹ˆ
  function nextRound() {
    if (currentRound < round) {
      currentRound++;
      resetGame();
      init();
    } else{
      document.getElementById('message').innerText = 'Game Over! All rounds completed.';
      document.getElementById('next-round-btn').hidden = false;
      endedgame();
    }
  }

  // à¸£à¸µà¹€à¸‹à¸•à¹€à¸à¸¡
  function resetGame() {
    guessSymbol.removeChild(guessSymbol.firstChild);
    clearButton();
    scoreText.hidden = true;
    incorrectGuessCount = 0;
    roundScore = 2.0;
    timer = null;
    gamestart = true;
    document.getElementById('hangmanCanvas').getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById('letter-box').innerHTML = '';
    document.getElementById('message').innerText = '';
    document.getElementById('timer-count').textContent = '';
    document.getElementById('earn-score').textContent = '';
    document.getElementById('clear-button').hidden = false;
    document.getElementById('submit-button').hidden = false;
    if (currentRound == round){
      document.getElementById('next-round-btn').hidden = true;
    } else{
      document.getElementById('next-round-btn').hidden = false;
    }
  }

  //à¸ªà¸¸à¹ˆà¸¡à¹‚à¸™à¹‰à¸•à¹€à¸à¸·à¹ˆà¸­à¸—à¸²à¸¢
  function setGuessNote(){
    const maxButtonSize = 50;
    guessNote = guessList[currentRound - 1];
    const imgElement = document.createElement('img');
    imgElement.src = symbolPath[guessNote];
    imgElement.alt = guessNote;
    imgElement.style.maxWidth = `${maxButtonSize}px`;
    imgElement.style.maxHeight = `${maxButtonSize}px`;
    guessSymbol.appendChild(imgElement);
  }

  //à¸§à¸²à¸”à¸•à¸±à¸§ Hangman
  function drawHangman() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "white";

    // à¸§à¸²à¸”à¸à¸²à¸™
    ctx.beginPath();
    ctx.moveTo(20, 180);
    ctx.lineTo(180, 180);
    ctx.stroke();

    if (incorrectGuessCount >= 1) {
      // à¸§à¸²à¸”à¹€à¸ªà¸²
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.moveTo(50, 180);
      ctx.lineTo(50, 20);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 2) {
      // à¸§à¸²à¸”à¹€à¸ªà¸²
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.moveTo(50, 20);
      ctx.lineTo(120, 20);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 3) {
      // à¸§à¸²à¸”à¹€à¸Šà¸·à¸­à¸
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.moveTo(120, 20);
      ctx.lineTo(120, 40);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 4) {
      // à¸§à¸²à¸”à¸«à¸±à¸§
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.arc(120, 60, 20, 0, 2 * Math.PI);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 5) {
      // à¸§à¸²à¸”à¸•à¸±à¸§
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.moveTo(120, 80);
      ctx.lineTo(120, 130);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 6) {
      // à¸§à¸²à¸”à¸‚à¸²à¸‹à¹‰à¸²à¸¢
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.moveTo(120, 130);
      ctx.lineTo(100, 170);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 7) {
      // à¸§à¸²à¸”à¸‚à¸²à¸‚à¸§à¸²
      roundScore -= 0.25;
      ctx.beginPath();
      ctx.moveTo(120, 130);
      ctx.lineTo(140, 170);
      ctx.stroke();
    }
  }

  // à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸¸à¹ˆà¸¡à¸à¸”à¸šà¸™à¸ˆà¸­
  function createLetterButtons() {
    const maxButtonSize = 50; // Set your desired maximum size in pixels

    for (let letter of symbolList[currentRound]) {
      const imageButton = document.createElement('img');
      imageButton.classList.add('image-button');
      imageButton.src = symbolPath[letter];
      imageButton.alt = letter;

      // Set maximum width and height
      imageButton.style.maxWidth = `${maxButtonSize}px`;
      imageButton.style.maxHeight = `${maxButtonSize}px`;

      imageButton.addEventListener('click', function () {
        const clickedValue = letter;
        addLetterToInput(clickedValue);
      });

      letterBox.appendChild(imageButton);
    }
  }


  // à¸à¸”à¸›à¸¸à¹ˆà¸¡à¸šà¸™à¸ˆà¸­
  function addLetterToInput(letter) {
    const maxButtonSize = 40;
    enteredWord += letter;
    const imgElement = document.createElement('img');
    imgElement.src = symbolPath[letter];
    imgElement.alt = letter;
    imgElement.style.maxWidth = `${maxButtonSize}px`;
    imgElement.style.maxHeight = `${maxButtonSize}px`;
    inputNote.appendChild(imgElement);
    }

  // à¸•à¸£à¸§à¸ˆà¸„à¸³à¸•à¸­à¸š
  function submitWord() {
    let sumNote = 0.0;

    //à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¸¡à¸µà¸›à¸£à¸°à¸ˆà¸¸à¸”à¹ƒà¸™à¸„à¸³à¸•à¸­à¸šà¹„à¸«à¸¡
    if (enteredWord.includes('.')) {
      let noteSymbol = '';
      let dotCount = 0;
      for (let letter of enteredWord) {
        //à¸šà¸§à¸à¸­à¸±à¸•à¸£à¸²à¸ªà¹ˆà¸§à¸™à¹‚à¸™à¹‡à¸•à¸à¹ˆà¸­à¸™ à¹à¸¥à¹‰à¸§à¸šà¸§à¸à¸›à¸£à¸°à¸ˆà¸¸à¸”à¸„à¸¹à¸“à¸à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¸›à¸£à¸°à¸ˆà¸¸à¸”
        let currentSymbol = letter;
        if (currentSymbol == '.') {
          dotCount++;
          sumNote += symbolDic[noteSymbol] / 2*dotCount;
        } else {
          dotCount = 0;
          noteSymbol = currentSymbol;
          sumNote += symbolDic[noteSymbol];
        }
      }
    } else {
      for (let char of enteredWord ){
        sumNote += symbolDic[char];
      }
    }
    if (sumNote === symbolDic[guessNote]) {
      document.getElementById('message').innerText = 'à¸¢à¸´à¸™à¸”à¸µà¸”à¹‰à¸§à¸¢ à¸„à¸¸à¸“à¸Šà¸™à¸°!';
      gamestart = false;
      score += roundScore;
      letterBox.hidden = true;
      earnScore.textContent = score;
      scoreText.hidden = false;
      
      document.getElementById('clear-button').hidden = true;
      document.getElementById('submit-button').hidden = true;
      if (currentRound == round) {
        saveScore();
        document.getElementById('try-again').hidden = false;
      }else{
        document.getElementById('next-round-btn').hidden = false;
      }
      
    } else {
      incorrectGuessCount++;
      drawHangman();
      clearButton();

      if (incorrectGuessCount === 7) {
        document.getElementById('message').innerText = `à¹€à¸ªà¸µà¸¢à¹ƒà¸ˆà¸”à¹‰à¸§à¸¢ à¸„à¸¸à¸“à¹à¸à¹‰`;
        clearInterval(timer);
        endedgame();
      }
    }
    
  }

  // à¸•à¸±à¸§à¸ˆà¸±à¸šà¹€à¸§à¸¥à¸²
  function startTimer() {
    let timeRemaining = 120;
    timerCount.textContent = timeRemaining;

    timer = setInterval(function() {
      timeRemaining--;

      if (gamestart == true) {
        if (timeRemaining >= 0) {
          timerCount.textContent = timeRemaining;
        } else {
          earnScore.textContent = score;
          clearInterval(timer);
          gamestart = false;
          document.getElementById('message').innerText = 'à¸«à¸¡à¸”à¹€à¸§à¸¥à¸²';
          document.getElementById('letter-box').remove();
          document.getElementById('clear-button').hidden = true;
          document.getElementById('submit-button').hidden = true;
          scoreText.hidden = false;
          earnScore.textContent = score;
          saveScore();
          document.getElementById('try-again').hidden = false;
        }
      }
    }, 1000);
  }

  // à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸°à¹à¸™à¸™à¸¥à¸‡à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
  function saveScore() {
    $.ajax({
    type: 'POST',
    url: '/api/savescore',
    contentType: 'application/json',
    data: JSON.stringify({"score": score, "gameName": gameName }),
    success: function(response) {
      console.log('Success:', response);
      },
      error: function(error) {
        console.error('Error:', error);
      }
    });
  }


  // à¸›à¸¸à¹ˆà¸¡à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸à¸¥à¹ˆà¸­à¸‡à¸„à¸³à¸•à¸­à¸š
  function clearButton() {
    while (inputNote.firstChild) {
      inputNote.removeChild(inputNote.firstChild);
    }
    enteredWord = '';
  }


  // à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡
  function init() {
    roundNumber.textContent = currentRound;
    letterBox.hidden = false;
    scoreText.hidden = true;
    document.getElementById('try-again').hidden = true;
    document.getElementById('next-round-btn').hidden = true;
    setGuessNote();
    createLetterButtons();
    gamestart = true;
  }

  // à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡à¹ƒà¸«à¸¡à¹ˆ
  function restartGame() {
    location.reload();
  }

  // à¹€à¸¡à¸·à¹ˆà¸­à¸ˆà¸šà¹€à¸à¸¡
  function endedgame(){
    letterBox.hidden = true;
    earnScore.textContent = score;
    scoreText.hidden = false;
    saveScore();
    document.getElementById('clear-button').hidden = true;
    document.getElementById('submit-button').hidden = true;
    document.getElementById('try-again').hidden = false;
  }

  // à¹€à¸£à¸µà¸¢à¸à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡
  init()
  startTimer();
</script>

</body>
</html>
