<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏´‡∏£‡∏£‡∏©‡∏≤ By ‡∏Ñ‡∏£‡∏π‡∏û‡∏µ‡πà‡πÑ‡∏°‡πâ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <style>
      .letter-box {
          width: 50px;
          height: 50px;
          margin: 5px;
          font-size: 20px;
          display: inline-block; /* Display letters in a row */
      }

      /* Style each letter box */
      .letter {
          display: inline-block;
          width: 40px;
          height: 40px;
          margin: 5px;
          text-align: center;
          line-height: 40px;
          background-color: #FFFFFF; /* Bootstrap primary color */
          color: #000; /* Text color */
          border-radius: 5px; /* Rounded corners */
          cursor: pointer; /* Cursor on hover */
      }
    </style>
</head>
<header>
  <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
          <a class="navbar-brand" href="/">‡πÄ‡∏Å‡∏°‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏´‡∏£‡∏£‡∏©‡∏≤ By ‡∏Ñ‡∏£‡∏π‡∏û‡∏µ‡πà‡πÑ‡∏°‡πâ</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                  <li class="nav-item">
                      <a class="nav-link" href="/hangmannote">‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡πÇ‡∏ô‡πä‡∏ï</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/hangmanchord">‡∏ó‡∏∞‡∏•‡∏∏‡∏ó‡∏∞‡∏•‡∏ß‡∏á‡∏ï‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏Ñ‡∏≠‡∏£‡πå‡∏î</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/viewscore">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/signout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                  </li>
              </ul>
          </div>
      </div>
  </nav>
</header>
<body>

  <div class="center container mt-5 rounded" style="max-width: 500px;">
    <br>
    <div id="timer" style="color: #FFFFFF">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ <span id="timer-count" style="color: #FFFFFF"></span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
    <div id="message" style="color: #FFFFFF"></div>
    <div id="score-text" style="color: #FFFFFF">‡πÑ‡∏î‡πâ <span id="earn-score" style="color: #FFFFFF"></span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
    <canvas id="hangmanCanvas" width="200" height="200"></canvas>
    <div id="guess-note" style="color: #FFFFFF">‡∏ú‡∏™‡∏°‡πÇ‡∏ô‡πâ‡∏ï‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ <span id="guess-note-symbol" style="color: #FFFFFF; font-size: 30px;"></span></div>

    <div id="answer-text" style="color: #FFFFFF;">‡πÄ‡∏â‡∏•‡∏¢ <span id="answer" style="color: #FFFFFF"></span></div>
    <div class="container mt-5">
      <div class="row">       
          <input type="text" id="input-word" class="form-control">
      </div>
      <br>
      <div class="row">
        <div id="letter-box" style="color: #FFFFFF;"></div>
      </div>
      <br>
      <div class="row">
        <div class="col-6">
          <button id="clear-button" type="button" class="btn btn-secondary" onclick="clearButton()">‡∏•‡πâ‡∏≤‡∏á</button>
        </div>
        <div class="col-1">
        </div>
        <div class="col-5">
          <button id="submit-button" type="button" class="btn btn-primary" onclick="submitWord()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
        </div>
      </div>
    </div>
    <br>
    <div>
      <button id="try-again" type="button" class="btn btn-danger" onclick="restartGame()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <br></br>
  </div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  
  const symbolList = ['ùÖù','ùÖû','ùÖü','ùÖ†','ùÖ°'];
  let symbolDic = {};
  symbolDic['ùÖù'] = 4;
  symbolDic['ùÖû'] = 2;
  symbolDic['ùÖü'] = 1;
  symbolDic['ùÖ†'] = 0.5;
  symbolDic['ùÖ°'] = 0.25;
  let guessedWord = [];
  let incorrectGuessCount = 0;
  let timer;
  let gamestart = false;
  let guessNote = '';
  let score = 10;

  const canvas = document.getElementById('hangmanCanvas');
  const ctx = canvas.getContext('2d');

  const letterBox = document.getElementById('letter-box');
  const inputWord = document.getElementById('input-word');
  const timerCount = document.getElementById('timer-count');
  const guessSymbol = document.getElementById('guess-note-symbol');
  const earnScore = document.getElementById('earn-score');
  const scoreText = document.getElementById('score-text');
  const timerText = document.getElementById('timer');

  scoreText.hidden = true;
  document.getElementById('answer-text').hidden = true;
  inputWord.addEventListener('keydown', function(event) {
    event.preventDefault();
  });

  //guessSymbol.textContent = guessNote;
  function setGuessNote(){
    const idx = Math.floor(Math.random() * (symbolList.length - 3));
    guessNote = symbolList[idx];
    guessSymbol.textContent = guessNote;
  }

  function drawHangman() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "white";

    // Draw the gallows
    ctx.beginPath();
    ctx.moveTo(20, 180);
    ctx.lineTo(180, 180);
    ctx.stroke();

    if (incorrectGuessCount >= 1) {
      // Draw the vertical pole
      ctx.beginPath();
      ctx.moveTo(50, 180);
      ctx.lineTo(50, 20);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 2) {
      // Draw the horizontal pole
      ctx.beginPath();
      ctx.moveTo(50, 20);
      ctx.lineTo(120, 20);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 3) {
      // Draw the rope
      ctx.beginPath();
      ctx.moveTo(120, 20);
      ctx.lineTo(120, 40);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 4) {
      // Draw the head
      ctx.beginPath();
      ctx.arc(120, 60, 20, 0, 2 * Math.PI);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 5) {
      // Draw the body
      ctx.beginPath();
      ctx.moveTo(120, 80);
      ctx.lineTo(120, 130);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 6) {
      // Draw the left leg
      ctx.beginPath();
      ctx.moveTo(120, 130);
      ctx.lineTo(100, 170);
      ctx.stroke();
    }

    if (incorrectGuessCount >= 7) {
      // Draw the right leg
      ctx.beginPath();
      ctx.moveTo(120, 130);
      ctx.lineTo(140, 170);
      ctx.stroke();
    }
  }

  // Create letter buttons
  function createLetterButtons() {
    for (let letter of symbolList) {
      if (letter != guessNote) {
        const letterButton = document.createElement('span');
        letterButton.classList.add('letter');
        letterButton.innerText = letter;
        letterButton.addEventListener('click', function() {
          addLetterToInput(letter);
        });
        letterBox.appendChild(letterButton);
      }
    }
  }

  // Add clicked letter to the input field
  function addLetterToInput(letter) {
    inputWord.value += letter;
  }

  // Submit word button handler
  function submitWord() {
    const enteredWord = inputWord.value;
    let sumNote = 0.0;
    for (let char of enteredWord ){
      sumNote += symbolDic[char];
    }
    if (sumNote === symbolDic[guessNote]) {
      document.getElementById('message').innerText = '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!';
      document.getElementById('answer').innerText = enteredWord;
      document.getElementById('answer-text').hidden = false;
      gamestart = false;
      endedgame();
    } else {
      incorrectGuessCount++;
      drawHangman();

      if (incorrectGuessCount === 7) {
        document.getElementById('message').innerText = `‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ`;
        clearInterval(timer);
        score = 0;
        endedgame();
      }
    }

    // Clear the input word
    inputWord.value = '';
  }

  function startTimer() {
    let timeRemaining = 10; // Set the time limit in seconds
    timerCount.textContent = timeRemaining;

    timer = setInterval(function() {
      timeRemaining--;

      if (gamestart == true){
        if (timeRemaining >= 0) {
          timerCount.textContent = timeRemaining;
          score = score - 1;
        } else {
          earnScore.textContent = score;
          clearInterval(timer);
          document.getElementById('message').innerText = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤';
          endedgame();
        }
      }
    }, 1000); // Update the timer every second
  }

  function saveScore() {
    $.ajax({
    type: 'POST',
    url: '/api/savescore',
    contentType: 'application/json',
    data: JSON.stringify(score),
    success: function(response) {
      console.log('Success:', response);
      // Handle success response from the server
      },
      error: function(error) {
        console.error('Error:', error);
        // Handle error
      }
    });
  }



  function clearButton() {
    inputWord.value = '';
  }


  // Initialize the game
  function init() {
    document.getElementById('try-again').hidden = true;
    setGuessNote();
    createLetterButtons();
    gamestart = true;
    startTimer();
  }

  function restartGame() {
    location.reload();
  }

  function endedgame(){
    letterBox.hidden = true;
    earnScore.textContent = score;
    scoreText.hidden = false;
    timerText.hidden = true;
    timerCount.hidden = true;
    saveScore();
    document.getElementById('clear-button').hidden = true;
    document.getElementById('submit-button').hidden = true;
    document.getElementById('try-again').hidden = false;
  }

  // Start the game
  init()
</script>

</body>
</html>
